<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bharat English Academy - Digital Lab</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- MODERN THEME (Glassmorphism & Gradients) --- */
        :root {
            --primary: #4f46e5;
            --accent: #0ea5e9;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-gradient: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: 1px solid rgba(255, 255, 255, 0.8);
            --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            --text-dark: #1e293b;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--bg-gradient);
            color: var(--text-dark);
            margin: 0;
            padding: 0;
            padding-bottom: 100px; /* Space for bottom nav */
        }

        /* Animated Background Shapes */
        .shape { position: fixed; border-radius: 50%; filter: blur(90px); z-index: -1; opacity: 0.5; }
        .s1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: #c7d2fe; }
        .s2 { bottom: -10%; right: -10%; width: 50vw; height: 50vw; background: #bae6fd; }

        /* Header */
        header {
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            position: sticky; top: 0; z-index: 100;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex; justify-content: space-between; align-items: center;
        }
        .logo { font-weight: 800; color: var(--primary); font-size: 1.2rem; display: flex; align-items: center; gap: 8px; }
        .xp-badge { background: var(--warning); color: #fff; padding: 5px 12px; border-radius: 20px; font-weight: bold; font-size: 0.9rem; }

        /* Main Grid Layout */
        .container {
            max-width: 1000px;
            margin: 30px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Responsive Grid */
            gap: 25px;
        }

        /* Full Width Items */
        .full-width { grid-column: 1 / -1; }

        /* Widget Card Design */
        .widget {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: var(--glass-border);
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .widget:hover { transform: translateY(-5px); box-shadow: 0 15px 40px rgba(0,0,0,0.1); }
        
        /* Widget Header */
        .widget h3 {
            margin: 0 0 15px 0;
            color: var(--primary);
            display: flex; align-items: center; gap: 10px;
            font-size: 1.2rem;
            border-bottom: 2px solid rgba(0,0,0,0.05);
            padding-bottom: 10px;
        }

        /* Inputs & Buttons */
        input, textarea, select {
            width: 100%; padding: 12px;
            border: 2px solid #e2e8f0; border-radius: 10px;
            font-size: 1rem; margin-bottom: 10px;
            background: rgba(255,255,255,0.8);
            box-sizing: border-box; transition: 0.3s;
        }
        input:focus { border-color: var(--primary); outline: none; background: #fff; }

        .btn {
            background: var(--primary); color: white; border: none;
            padding: 10px 20px; border-radius: 10px; cursor: pointer;
            font-weight: 600; width: 100%; transition: 0.2s;
            display: flex; justify-content: center; align-items: center; gap: 8px;
        }
        .btn:hover { background: #4338ca; }
        .btn-small { width: auto; padding: 5px 15px; font-size: 0.9rem; }

        /* Output Boxes */
        .output {
            background: #f8fafc; border-left: 4px solid var(--accent);
            padding: 15px; border-radius: 8px; margin-top: 15px;
            display: none; animation: slideIn 0.3s ease;
        }
        @keyframes slideIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

        /* Dictionary Specifics */
        .dict-meaning { margin-bottom: 10px; }
        .dict-part { color: var(--accent); font-weight: bold; font-size: 0.8rem; text-transform: uppercase; }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: #1e293b; padding: 10px 25px; border-radius: 50px;
            display: flex; gap: 25px; z-index: 1000; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .bottom-nav a { color: #94a3b8; font-size: 1.4rem; transition: 0.3s; }
        .bottom-nav a:hover, .bottom-nav a.active { color: #fff; transform: scale(1.1); }

    </style>
</head>
<body>

    <div class="shape s1"></div>
    <div class="shape s2"></div>

    <header>
        <div class="logo"><i class="fa-solid fa-graduation-cap"></i> Bharat English Lab</div>
        <div class="xp-badge">XP: <span id="xp-points">0</span></div>
    </header>

    <div class="container">

        <div class="widget full-width" id="dict-widget">
            <h3><i class="fa-solid fa-book-open"></i> Smart Dictionary</h3>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="dict-input" placeholder="Enter a word (e.g. Diligent)...">
                <button class="btn btn-small" onclick="fetchMeaning()"><i class="fa-solid fa-search"></i></button>
            </div>
            
            <div id="dict-output" class="output">
                <h2 style="margin:0; color:var(--primary); display:flex; justify-content:space-between;">
                    <span id="word-title">Word</span>
                    <i class="fa-solid fa-volume-high" style="cursor:pointer; color:#64748b;" onclick="playAudio()"></i>
                </h2>
                <p style="color:#64748b; font-style:italic;" id="word-phonetic">/phonetic/</p>
                <hr style="border:0; border-top:1px solid #eee;">
                <div id="meanings-list"></div>
            </div>
        </div>

        <div class="widget">
            <h3><i class="fa-solid fa-comments"></i> Speech Converter</h3>
            <p style="font-size:0.9rem; color:#666;">Converts Simple Present to Past.</p>
            
            <label style="font-size:0.8rem; font-weight:bold;">Direct Speech:</label>
            <input type="text" id="direct-input" placeholder='He says, "I am happy"'>
            
            <button class="btn" onclick="convertSpeech()">Convert to Indirect</button>
            
            <div id="speech-output" class="output">
                <strong>Result:</strong> <br>
                <span id="indirect-result" style="color:var(--primary); font-weight:600;">...</span>
                <p style="font-size:0.8rem; color:#666; margin-top:5px;">ðŸ’¡ Rule: <span id="speech-rule">...</span></p>
            </div>
        </div>

        <div class="widget">
            <h3><i class="fa-solid fa-rotate"></i> Voice Changer</h3>
            <p style="font-size:0.9rem; color:#666;">Works for S + V + O sentences.</p>
            
            <label style="font-size:0.8rem; font-weight:bold;">Active Voice:</label>
            <input type="text" id="active-input" placeholder='Ram eats a mango'>
            
            <button class="btn" onclick="convertVoice()">Convert to Passive</button>
            
            <div id="voice-output" class="output">
                <strong>Passive Voice:</strong> <br>
                <span id="passive-result" style="color:var(--success); font-weight:600;">...</span>
            </div>
        </div>

        <div class="widget">
            <h3><i class="fa-solid fa-pen-nib"></i> Letter Generator</h3>
            <input type="text" id="l-subject" placeholder="Subject (Vishay)">
            <textarea id="l-reason" rows="2" placeholder="Reason (Karan)"></textarea>
            <button class="btn" onclick="generateLetter()">Generate</button>
            <div id="letter-output" class="output" style="white-space: pre-wrap; font-family: monospace; font-size:0.8rem;"></div>
        </div>

    </div>

    <nav class="bottom-nav">
        <a href="#" class="active"><i class="fa-solid fa-house"></i></a>
        <a href="#dict-widget"><i class="fa-solid fa-book"></i></a>
        <a href="#voice-output"><i class="fa-solid fa-wand-magic-sparkles"></i></a>
    </nav>

    <script>
        /* --- 1. DICTIONARY LOGIC (Real API) --- */
        let audioUrl = "";

        async function fetchMeaning() {
            const word = document.getElementById('dict-input').value;
            const output = document.getElementById('dict-output');
            const list = document.getElementById('meanings-list');
            
            if(!word) return;

            output.style.display = "block";
            list.innerHTML = "Loading...";

            try {
                const response = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                const data = await response.json();

                if(data.title) {
                    list.innerHTML = "Word not found.";
                    return;
                }

                const entry = data[0];
                document.getElementById('word-title').innerText = entry.word;
                document.getElementById('word-phonetic').innerText = entry.phonetic || "";
                
                // Find audio
                const audioObj = entry.phonetics.find(p => p.audio);
                audioUrl = audioObj ? audioObj.audio : "";

                // Show meanings
                list.innerHTML = "";
                entry.meanings.forEach(m => {
                    let def = m.definitions[0].definition;
                    list.innerHTML += `<div class="dict-meaning"><span class="dict-part">${m.partOfSpeech}</span>: ${def}</div>`;
                });
                
                addXP(5); // Reward

            } catch (error) {
                list.innerHTML = "Error fetching data.";
            }
        }

        function playAudio() {
            if(audioUrl) new Audio(audioUrl).play();
            else alert("Audio not available for this word.");
        }

        /* --- 2. SPEECH CONVERTER (Rule Based) --- */
        function convertSpeech() {
            let input = document.getElementById('direct-input').value.trim();
            let result = "";
            let rule = "";

            // Simple Heuristics for demo purposes
            if (input.toLowerCase().includes("says")) {
                // Reporting verb is Present -> No change in tense
                result = input.replace(/, "/g, " that ").replace(/"/g, "");
                // Pronoun changes (Basic)
                result = result.replace(/\bI\b/g, "he/she").replace(/\bam\b/g, "is");
                rule = "Reporting verb 'says' is present, so tense does not change.";
            } else if (input.toLowerCase().includes("said")) {
                // Reporting verb is Past -> Change tense
                result = input.replace(/, "/g, " that ").replace(/"/g, "");
                // Tense Change: Simple Present -> Simple Past
                result = result.replace(/\bam\b/g, "was").replace(/\bis\b/g, "was").replace(/\bare\b/g, "were");
                result = result.replace(/\bplay\b/g, "played").replace(/\beat\b/g, "ate");
                // Pronouns
                result = result.replace(/\bI\b/g, "he/she");
                rule = "Reporting verb 'said' is past, so Present Tense changes to Past Tense.";
            } else {
                result = "Please enter standard format: He said, \"I am happy\"";
                rule = "Format check failed.";
            }

            document.getElementById('indirect-result').innerText = result;
            document.getElementById('speech-rule').innerText = rule;
            document.getElementById('speech-output').style.display = "block";
            addXP(10);
        }

        /* --- 3. VOICE CONVERTER (Active -> Passive) --- */
        // Database of V1, V2, V3 forms for conversion
        const verbDB = {
            "eat": { v2: "ate", v3: "eaten" },
            "plays": { v2: "played", v3: "played" },
            "write": { v2: "wrote", v3: "written" },
            "writes": { v2: "wrote", v3: "written" },
            "love": { v2: "loved", v3: "loved" },
            "loves": { v2: "loved", v3: "loved" },
            "help": { v2: "helped", v3: "helped" }
        };

        function convertVoice() {
            let input = document.getElementById('active-input').value.trim().toLowerCase();
            let words = input.split(" ");
            let output = document.getElementById('voice-output');
            
            // Basic Logic for "Subject + Verb + Object" (3 words minimum)
            if (words.length < 3) {
                document.getElementById('passive-result').innerText = "Sentence too short. Try: 'Ram eats food'";
                output.style.display = "block";
                return;
            }

            let subject = words[0];
            let verb = words[1]; 
            let object = words.slice(2).join(" "); // Rest of sentence
            
            let newVerb = "";
            let helper = "is";

            // Check if verb is in our database
            if (verbDB[verb]) {
                newVerb = verbDB[verb].v3;
            } else if (verb.endsWith("s")) {
                // Guessing for regular verbs
                newVerb = verb.slice(0, -1) + "ed"; 
            } else {
                newVerb = verb + "ed";
            }

            // Construct Passive: Object + is/am/are + V3 + by + Subject
            let result = `${object} ${helper} ${newVerb} by ${subject}`;
            
            // Capitalize first letter
            result = result.charAt(0).toUpperCase() + result.slice(1);

            document.getElementById('passive-result').innerText = result;
            output.style.display = "block";
            addXP(10);
        }

        /* --- UTILS --- */
        function generateLetter() {
            let s = document.getElementById('l-subject').value;
            let r = document.getElementById('l-reason').value;
            let date = new Date().toLocaleDateString();
            let t = `To, The Principal\nDate: ${date}\nSubject: ${s}\n\nRespected Sir,\nMost respectfully... ${r}\n\nYours Obediently,\nXYZ`;
            let out = document.getElementById('letter-output');
            out.innerText = t;
            out.style.display = 'block';
        }

        let xp = 0;
        function addXP(amount) {
            xp += amount;
            document.getElementById('xp-points').innerText = xp;
        }
    </script>
</body>
</html>
